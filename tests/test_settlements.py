
from context import aemo
import dateutil
import pydantic


def FILE_GOOD():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_LINES():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,11,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_MISSING_HEADINGS_MIDDLE():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_COLS():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_DATA_TYPE_1():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/05/32 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_DATA_TYPE_2():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,abc,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_DATA_TYPE_3():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1.1,1,5.5,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_WRONG_TABLE_KEY():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,5.5,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,CPDATA,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_MULTIPLE_C_ROWS():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
D,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,5.5,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
C,ABC,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,CPDATA,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def FILE_INVALID_ROW_TYPE():
    return """C,SETP.WORLD,SETTLEMENTS,AEMO,TESTCPY,2025/12/31,02:01:00,123456,SETTLEMENTS,123456,,,,,,,,,,,,,,,,,,,,,
I,SETTLEMENTS,NMAS_RECOVERY,2,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,SERVICE,CONTRACTID,PAYMENTTYPE,REGIONID,RBF,PAYMENT_AMOUNT,PARTICIPANT_ENERGY,REGION_ENERGY,RECOVERY_AMOUNT,LASTCHANGED,PARTICIPANT_GENERATION,REGION_GENERATION,RECOVERY_AMOUNT_CUSTOMER,RECOVERY_AMOUNT_GENERATOR,,,,,,,,,
Z,SETTLEMENTS,NMAS_RECOVERY,2,2025/12/31 00:00:00,1,1,TESTCPY,RESTART,XYZ123,AVAILABILITY,TAS1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,,,,,,,,,
I,SETTLEMENTS,CPDATA,5,SETTLEMENTDATE,VERSIONNO,PERIODID,PARTICIPANTID,TCPID,REGIONID,IGENERGY,XGENERGY,INENERGY,XNENERGY,IPOWER,XPOWER,RRP,EEP,TLF,CPRRP,CPEEP,TA,EP,APC,RESC,RESP,METERRUNNO,HOSTDISTRIBUTOR,MDA,LASTCHANGED,METERDATA_SOURCE
D,SETTLEMENTS,CPDATA,5,2025/12/31 00:00:00,1,1,TESTCPY,ABCD,TAS1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,1,,MSATS,2025/12/31 02:01:00,
I,SETTLEMENTS,FCAS_RECOVERY,6,SETTLEMENTDATE,VERSIONNO,PARTICIPANTID,REGIONID,PERIODID,LOWER6SEC_RECOVERY,RAISE6SEC_RECOVERY,LOWER60SEC_RECOVERY,RAISE60SEC_RECOVERY,LOWER5MIN_RECOVERY,RAISE5MIN_RECOVERY,LOWERREG_RECOVERY,RAISEREG_RECOVERY,LASTCHANGED,LOWER6SEC_RECOVERY_GEN,RAISE6SEC_RECOVERY_GEN,LOWER60SEC_RECOVERY_GEN,RAISE60SEC_RECOVERY_GEN,LOWER5MIN_RECOVERY_GEN,RAISE5MIN_RECOVERY_GEN,LOWERREG_RECOVERY_GEN,RAISEREG_RECOVERY_GEN,,,,,
D,SETTLEMENTS,FCAS_RECOVERY,6,2025/12/31 00:00:00,1,TESTCPY,TAS1,1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,2025/12/31 02:01:00,1.1,1.1,1.1,1.1,1.1,1.1,1.1,1.1,,,,,
I,SETTLEMENTS,MARKETFEES,5,SETTLEMENTDATE,RUNNO,PARTICIPANTID,PERIODID,MARKETFEEID,MARKETFEEVALUE,ENERGY,LASTCHANGED,PARTICIPANTCATEGORYID,,,,,,,,,,,,,,,,,,
D,SETTLEMENTS,MARKETFEES,5,2025/12/31 00:00:00,1,TESTCPY,1,V_EST,1.1,1.1,2025/12/31 02:01:00,XYZ,,,,,,,,,,,,,,,,,,
C,END OF REPORT,10,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""


def test_parse_good_file():
    _ = aemo.NemFile.from_str(FILE_GOOD())


def test_parse_missing_in_middle():
    try:
        _ = aemo.NemFile.from_str(FILE_MISSING_HEADINGS_MIDDLE())
    except aemo.key.TableRowsMustHaveSameKey:
        assert True


# expect invalid rows
def test_parse_wrong_lines():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_LINES())
    except aemo.InvalidNumberOfRows:
        assert True


def test_parse_wrong_cols():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_COLS())
    except IndexError:
        assert True


def test_parse_dateutil_error():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_DATA_TYPE_1())
    except dateutil.parser._parser.ParserError:
        assert True


def test_parse_validation_error_1():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_DATA_TYPE_2())
    except pydantic.error_wrappers.ValidationError:
        assert True


def test_parse_validation_error_2():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_DATA_TYPE_3())
    except pydantic.error_wrappers.ValidationError:
        assert True


def test_parse_wrong_table_key():
    try:
        _ = aemo.NemFile.from_str(FILE_WRONG_TABLE_KEY())
    except aemo.key.TableRowsMustHaveSameKey:
        assert True


def test_parse_too_many_c_rows():
    try:
        _ = aemo.NemFile.from_str(FILE_MULTIPLE_C_ROWS())
    except aemo.UnexpectedRow:
        assert True


def test_parse_invalid_row_type():
    try:
        _ = aemo.NemFile.from_str(FILE_INVALID_ROW_TYPE())
    except aemo.UnexpectedRow:
        assert True
